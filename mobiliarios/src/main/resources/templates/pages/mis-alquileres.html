<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis alquileres | FURENT</title>
    <!-- Script inline para aplicar tema ANTES de cargar CSS y evitar parpadeos -->
    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = savedTheme || (prefersDark ? 'dark' : 'light');
            const bg = theme === 'dark' ? '#0f172a' : '#ffffff';
            const style = document.createElement('style');
            style.id = 'pre-theme-style';
            style.textContent = `html,body{background:${bg};}`;
            document.head.appendChild(style);
            if (theme === 'dark') {
                document.documentElement.classList.add('dark-mode');
            } else {
                document.documentElement.classList.remove('dark-mode');
            }
        })();
    </script>
    <link rel="stylesheet" th:href="@{/css/normalize.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" th:href="@{/css/app.css}">
    <link rel="stylesheet" th:href="@{/css/estilos.css}">
    <link rel="stylesheet" th:href="@{/css/modern-styles.css}">
    <link rel="stylesheet" th:href="@{/css/dark-mode.css}">
    <link rel="stylesheet" th:href="@{/css/cart-preview.css}">
    <link rel="stylesheet" th:href="@{/css/header-adjustments.css}">
    <link rel="stylesheet" th:href="@{/css/payment-notifications.css}">
    <link rel="stylesheet" th:href="@{/css/resenas.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script th:src="@{/js/theme-toggle.js}"></script>
    <script th:src="@{/js/format-utils.js}"></script>
    <script th:src="@{/js/cart-preview.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script th:src="@{/js/payment-notifications.js}"></script>
    <script th:src="@{/js/resenas.js}"></script>
    <style>
        .alquileres-page { padding: 40px 0; min-height: 70vh; }
        .alquileres-container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .alquileres-header { margin-bottom: 30px; text-align: center; }
        .alquileres-header h1 { font-size: 32px; color: #2c3e50; margin-bottom: 8px; font-weight: 700; }
        .alquileres-header p { color: #7f8c8d; font-size: 16px; }
        
        /* Tarjeta compacta y moderna */
        .alquiler-card { 
            background: white; 
            border-radius: 16px; 
            padding: 25px; 
            padding-bottom: 140px;
            margin-bottom: 16px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.08); 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(0,0,0,0.05);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s ease forwards;
            position: relative;
        }
        .alquiler-card:nth-child(1) { animation-delay: 0.1s; }
        .alquiler-card:nth-child(2) { animation-delay: 0.2s; }
        .alquiler-card:nth-child(3) { animation-delay: 0.3s; }
        .alquiler-card:nth-child(4) { animation-delay: 0.4s; }
        .alquiler-card:hover { 
            box-shadow: 0 8px 24px rgba(0,0,0,0.12); 
            transform: translateY(-4px);
            border-color: rgba(140, 188, 0, 0.2);
        }
        
        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Header compacto */
        .alquiler-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding-bottom: 15px; 
            border-bottom: 1px solid #e8e8e8; 
            margin-bottom: 15px; 
        }
        .alquiler-id { 
            font-size: 16px; 
            font-weight: 700; 
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .alquiler-id i { color: #8cbc00; font-size: 18px; }
        .alquiler-date { 
            color: #95a5a6; 
            font-size: 13px; 
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Status badges modernos */
        .alquiler-status { 
            padding: 6px 16px; 
            border-radius: 20px; 
            font-weight: 600; 
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
        }
        .alquiler-status::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        .status-pendiente { background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%); color: #856404; }
        .status-pendiente::before { background: #856404; }
        .status-confirmado { background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%); color: #0c5460; }
        .status-confirmado::before { background: #0c5460; }
        .status-en_curso { background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); color: #155724; }
        .status-en_curso::before { background: #155724; }
        .status-completado { background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); color: #155724; }
        .status-completado::before { background: #155724; }
        .status-cancelado { background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); color: #721c24; }
        .status-cancelado::before { background: #721c24; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
        
        /* Detalles en grid compacto */
        .alquiler-details { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 12px; 
            margin-bottom: 15px;
            background: #f8f9fa;
            padding: 12px;
            border-radius: 10px;
        }
        
        /* Vista compacta - resumen */
        .alquiler-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .alquiler-info-compact {
            flex: 1;
            min-width: 200px;
        }
        
        .alquiler-items-count {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 8px;
        }
        
        .alquiler-items-count i {
            color: #8cbc00;
            font-size: 16px;
        }
        
        .alquiler-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: stretch;
        }
        
        .btn-ver-detalles {
            background: linear-gradient(135deg, #8cbc00, #037bc0);
            color: white;
            padding: 10px 24px;
            border-radius: 20px;
            border: none;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 2px 10px rgba(140, 188, 0, 0.2);
        }
        
        .btn-ver-detalles:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(140, 188, 0, 0.3);
        }
        
        .btn-dejar-resena {
            background: linear-gradient(135deg, #8cbc00, #037bc0);
            color: white;
            padding: 10px 24px;
            border-radius: 20px;
            border: none;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 2px 10px rgba(140, 188, 0, 0.2);
            margin-top: 30px;
        }
        
        .btn-dejar-resena:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(140, 188, 0, 0.3);
        }
        
        .btn-dejar-resena i {
            font-size: 14px;
        }
        
        .btn-cancelar {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            padding: 10px 24px;
            border-radius: 20px;
            border: none;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 10px rgba(220, 53, 69, 0.2);
        }
        
        .btn-cancelar:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
            background: linear-gradient(135deg, #c82333, #bd2130);
        }
        
        .btn-cancelar:disabled {
            background: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .btn-cancelar:disabled:hover {
            transform: none;
            box-shadow: 0 2px 10px rgba(108, 117, 125, 0.2);
        }
        
        .alquiler-price-compact {
            text-align: right;
        }
        
        .alquiler-price-compact .price-label {
            font-size: 12px;
            color: #95a5a6;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .alquiler-price-compact .price-value {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, #8cbc00, #037bc0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: block;
        }
        .detail-group { 
            display: flex; 
            flex-direction: column; 
            gap: 4px; 
        }
        .detail-label { 
            font-size: 11px; 
            color: #95a5a6; 
            text-transform: uppercase; 
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        .detail-value { 
            font-size: 14px; 
            color: #2c3e50;
            font-weight: 500;
        }
        
        /* Items compactos */
        .alquiler-items { margin-top: 15px; }
        .alquiler-items h4 { 
            font-size: 14px; 
            color: #2c3e50; 
            margin-bottom: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .alquiler-items h4 i { color: #8cbc00; }
        
        .alquiler-item { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            padding: 8px; 
            background: #f8f9fa; 
            border-radius: 10px; 
            margin-bottom: 8px;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        .alquiler-item:hover {
            background: #fff;
            border-color: #e8e8e8;
            transform: translateX(4px);
        }
        
        .alquiler-item-image { 
            width: 50px; 
            height: 50px; 
            border-radius: 8px; 
            overflow: hidden;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .alquiler-item-image img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        .alquiler-item:hover .alquiler-item-image img {
            transform: scale(1.1);
        }
        
        .alquiler-item-info { flex: 1; }
        .alquiler-item-name { 
            font-weight: 600; 
            color: #2c3e50; 
            margin-bottom: 3px;
            font-size: 14px;
        }
        .alquiler-item-quantity { 
            font-size: 12px; 
            color: #95a5a6;
            display: flex;
            gap: 12px;
        }
        .alquiler-item-quantity span {
            font-weight: 600;
            color: #2c3e50;
        }
        .alquiler-item-price { 
            font-weight: 700; 
            color: #8cbc00; 
            font-size: 15px;
            flex-shrink: 0;
        }
        
        /* Total destacado */
        .alquiler-total { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 12px 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            margin-top: 15px;
        }
        .alquiler-total-label { 
            font-size: 15px; 
            font-weight: 600; 
            color: #2c3e50;
        }
        .alquiler-total-amount { 
            font-size: 22px; 
            font-weight: 800; 
            background: linear-gradient(135deg, #8cbc00, #037bc0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Empty state */
        .empty-alquileres { 
            text-align: center; 
            padding: 60px 20px; 
            background: white; 
            border-radius: 16px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .empty-alquileres i { 
            font-size: 80px; 
            color: #e0e0e0; 
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .empty-alquileres h2 { 
            font-size: 26px; 
            color: #2c3e50; 
            margin-bottom: 10px;
            font-weight: 700;
        }
        .empty-alquileres p { 
            font-size: 16px; 
            color: #7f8c8d; 
            margin-bottom: 25px; 
        }
        
        .btn-primary { 
            background: linear-gradient(135deg, #8cbc00, #037bc0); 
            color: white; 
            padding: 12px 32px; 
            border-radius: 25px; 
            text-decoration: none; 
            display: inline-block; 
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(140, 188, 0, 0.3);
        }
        .btn-primary:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 6px 20px rgba(140, 188, 0, 0.4);
        }
        
        /* Alerts */
        .alert { 
            padding: 12px 16px; 
            border-radius: 10px; 
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideDown 0.3s ease;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .alert i { font-size: 18px; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        
        /* Dark mode */
        body.dark-mode .alquiler-card { background: #1a1a2e; border-color: rgba(255,255,255,0.1); }
        body.dark-mode .alquiler-card:hover { border-color: rgba(140, 188, 0, 0.3); }
        body.dark-mode .alquiler-id { color: #fff; }
        body.dark-mode .alquiler-date { color: #95a5a6; }
        body.dark-mode .alquiler-header { border-bottom-color: rgba(255,255,255,0.1); }
        body.dark-mode .alquiler-details { background: rgba(255,255,255,0.05); }
        body.dark-mode .detail-value { color: #e0e0e0; }
        body.dark-mode .alquiler-item { background: rgba(255,255,255,0.05); }
        body.dark-mode .alquiler-item:hover { background: rgba(255,255,255,0.08); }
        body.dark-mode .alquiler-item-name { color: #fff; }
        body.dark-mode .alquiler-total { background: rgba(255,255,255,0.05); }
        body.dark-mode .alquiler-total-label { color: #e0e0e0; }
        body.dark-mode .empty-alquileres { background: #1a1a2e; }
        body.dark-mode .empty-alquileres h2 { color: #fff; }
        body.dark-mode .alquileres-header h1 { color: #fff; }
        
        /* Modal para vista detallada */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .modal-overlay.active {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            opacity: 1;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 0;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
            position: relative;
        }
        
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
        
        .modal-header {
            background: linear-gradient(135deg, #8cbc00, #037bc0);
            color: white;
            padding: 24px 30px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .modal-section {
            margin-bottom: 25px;
        }
        
        .modal-section-title {
            font-size: 16px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e8e8e8;
        }
        
        .modal-section-title i {
            color: #8cbc00;
            font-size: 18px;
        }
        
        /* Estilos dark mode para modal */
        body.dark-mode .modal-content {
            background: #1a1a2e;
        }
        
        body.dark-mode .modal-body {
            background: #1a1a2e;
        }
        
        body.dark-mode .modal-section-title {
            color: #fff;
            border-bottom-color: rgba(255,255,255,0.1);
        }
        
        /* Barra de búsqueda y filtros */
        .search-filter-container {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-box input {
            width: 100%;
            padding: 14px 20px 14px 50px;
            border: 2px solid #e8e8e8;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #8cbc00;
            background: white;
            box-shadow: 0 0 0 3px rgba(140, 188, 0, 0.1);
        }
        
        .search-box i {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: #95a5a6;
            font-size: 18px;
        }
        
        .filters-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: #2c3e50;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .filter-select,
        .filter-input {
            padding: 12px 15px;
            border: 2px solid #e8e8e8;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #f8f9fa;
            cursor: pointer;
        }
        
        .filter-select:focus,
        .filter-input:focus {
            outline: none;
            border-color: #8cbc00;
            background: white;
            box-shadow: 0 0 0 3px rgba(140, 188, 0, 0.1);
        }
        
        .filter-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            align-items: center;
        }
        
        .btn-clear-filters {
            background: #e8e8e8;
            color: #2c3e50;
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn-clear-filters:hover {
            background: #d0d0d0;
            transform: translateY(-1px);
        }
        
        .results-count {
            font-size: 14px;
            color: #7f8c8d;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .results-count strong {
            color: #8cbc00;
            font-size: 16px;
        }
        
        .no-results {
            text-align: center;
            padding: 40px 20px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: none;
        }
        
        .no-results.show {
            display: block;
        }
        
        .no-results i {
            font-size: 60px;
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        
        .no-results h3 {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .no-results p {
            font-size: 14px;
            color: #7f8c8d;
        }
        
        /* Dark mode para búsqueda y filtros */
        body.dark-mode .search-filter-container {
            background: #1a1a2e;
            border-color: rgba(255,255,255,0.1);
        }
        
        body.dark-mode .search-box input,
        body.dark-mode .filter-select,
        body.dark-mode .filter-input {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.1);
            color: #e0e0e0;
        }
        
        body.dark-mode .search-box input:focus,
        body.dark-mode .filter-select:focus,
        body.dark-mode .filter-input:focus {
            background: rgba(255,255,255,0.08);
        }
        
        body.dark-mode .filter-label {
            color: #e0e0e0;
        }
        
        body.dark-mode .btn-clear-filters {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
        }
        
        body.dark-mode .btn-clear-filters:hover {
            background: rgba(255,255,255,0.15);
        }
        
        body.dark-mode .no-results {
            background: #1a1a2e;
        }
        
        body.dark-mode .no-results h3 {
            color: #fff;
        }
        
        /* Botón Ver Más/Menos */
        .ver-mas-container {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
        }
        
        .btn-ver-mas {
            background: linear-gradient(135deg, #8cbc00, #037bc0);
            color: white;
            padding: 14px 40px;
            border-radius: 25px;
            border: none;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(140, 188, 0, 0.3);
        }
        
        .btn-ver-mas:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(140, 188, 0, 0.4);
        }
        
        .btn-ver-mas i {
            font-size: 18px;
            transition: transform 0.3s ease;
        }
        
        .btn-ver-mas:hover i {
            transform: translateY(2px);
        }
        
        .btn-ver-mas.ver-menos i {
            transform: rotate(180deg);
        }
        
        .btn-ver-mas.ver-menos:hover i {
            transform: rotate(180deg) translateY(-2px);
        }
        
        .alquiler-card.hidden {
            display: none !important;
        }
        
        /* Animación de Preparando Envío */
        .shipping-animation-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .shipping-animation-overlay.compressed {
            position: relative;
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #8cbc00, #037bc0);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(140, 188, 0, 0.4);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 30px;
            flex-shrink: 0;
        }
        
        .shipping-animation-overlay.compressed:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(140, 188, 0, 0.6);
        }
        
        .shipping-animation-overlay.compressed {
            font-size: 28px;
            animation: pulse 2s infinite;
            position: relative;
        }
        
        /* Tooltip personalizado */
        .shipping-animation-overlay.compressed::before {
            content: 'Preparando envío';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 1000;
        }
        
        .shipping-animation-overlay.compressed::after {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-2px);
            border: 5px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 1000;
        }
        
        .shipping-animation-overlay.compressed:hover::before {
            opacity: 1;
            transform: translateX(-50%) translateY(-12px);
        }
        
        .shipping-animation-overlay.compressed:hover::after {
            opacity: 1;
            transform: translateX(-50%) translateY(-6px);
        }
        
        body.dark-mode .shipping-animation-overlay.compressed::before {
            background: rgba(255, 255, 255, 0.95);
            color: #1a1a2e;
        }
        
        body.dark-mode .shipping-animation-overlay.compressed::after {
            border-top-color: rgba(255, 255, 255, 0.95);
        }
        
        body.dark-mode .shipping-animation-overlay {
            background: rgba(26, 26, 46, 0.98);
        }
        
        /* Animación de Entrega en Curso */
        .delivery-animation-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .delivery-animation-overlay.compressed {
            position: relative;
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #037bc0, #8cbc00);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(3, 123, 192, 0.4);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 30px;
            flex-shrink: 0;
            font-size: 28px;
            animation: pulse 2s infinite;
        }
        
        .delivery-animation-overlay.compressed:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(3, 123, 192, 0.6);
        }
        
        /* Tooltip para entrega en curso */
        .delivery-animation-overlay.compressed::before {
            content: 'Entrega en curso';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 1000;
        }
        
        .delivery-animation-overlay.compressed::after {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-2px);
            border: 5px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 1000;
        }
        
        .delivery-animation-overlay.compressed:hover::before {
            opacity: 1;
            transform: translateX(-50%) translateY(-12px);
        }
        
        .delivery-animation-overlay.compressed:hover::after {
            opacity: 1;
            transform: translateX(-50%) translateY(-6px);
        }
        
        body.dark-mode .delivery-animation-overlay {
            background: rgba(26, 26, 46, 0.98);
        }
        
        body.dark-mode .delivery-animation-overlay.compressed::before {
            background: rgba(255, 255, 255, 0.95);
            color: #1a1a2e;
        }
        
        body.dark-mode .delivery-animation-overlay.compressed::after {
            border-top-color: rgba(255, 255, 255, 0.95);
        }
        
        .delivery-truck-container {
            position: relative;
            width: 250px;
            height: 150px;
            margin-bottom: 20px;
        }
        
        .delivery-road {
            position: absolute;
            bottom: 30px;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ccc 0%, #ccc 50%, transparent 50%, transparent 100%);
            background-size: 20px 4px;
            animation: roadMove 1s linear infinite;
        }
        
        @keyframes roadMove {
            0% { background-position: 0 0; }
            100% { background-position: 20px 0; }
        }
        
        .delivery-truck {
            position: absolute;
            bottom: 34px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 60px;
            animation: truckBounce 0.5s ease-in-out infinite;
        }
        
        @keyframes truckBounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-5px); }
        }
        
        .delivery-smoke {
            position: absolute;
            bottom: 50px;
            left: 30%;
            width: 15px;
            height: 15px;
            background: rgba(150, 150, 150, 0.5);
            border-radius: 50%;
            animation: smokeRise 1.5s ease-out infinite;
        }
        
        .delivery-smoke:nth-child(2) {
            animation-delay: 0.5s;
        }
        
        .delivery-smoke:nth-child(3) {
            animation-delay: 1s;
        }
        
        @keyframes smokeRise {
            0% {
                opacity: 0.7;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-40px) scale(1.5);
            }
        }
        
        .delivery-text {
            text-align: center;
            animation: textPulse 1.5s ease-in-out infinite;
        }
        
        .delivery-text h3 {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #037bc0, #8cbc00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        
        .delivery-text p {
            font-size: 14px;
            color: #7f8c8d;
            margin: 0;
        }
        
        /* Animación de Entrega Completada */
        .completed-animation-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .completed-animation-overlay.compressed {
            position: relative;
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 30px;
            flex-shrink: 0;
            font-size: 28px;
            animation: pulse 2s infinite;
        }
        
        .completed-animation-overlay.compressed:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.6);
        }
        
        /* Tooltip para entrega completada */
        .completed-animation-overlay.compressed::before {
            content: 'Entrega completada';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 1000;
        }
        
        .completed-animation-overlay.compressed::after {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-2px);
            border: 5px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 1000;
        }
        
        .completed-animation-overlay.compressed:hover::before {
            opacity: 1;
            transform: translateX(-50%) translateY(-12px);
        }
        
        .completed-animation-overlay.compressed:hover::after {
            opacity: 1;
            transform: translateX(-50%) translateY(-6px);
        }
        
        body.dark-mode .completed-animation-overlay {
            background: rgba(26, 26, 46, 0.98);
        }
        
        body.dark-mode .completed-animation-overlay.compressed::before {
            background: rgba(255, 255, 255, 0.95);
            color: #1a1a2e;
        }
        
        body.dark-mode .completed-animation-overlay.compressed::after {
            border-top-color: rgba(255, 255, 255, 0.95);
        }
        
        .completed-check-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin-bottom: 20px;
        }
        
        .completed-product {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            animation: productBounce 0.6s ease-out;
        }
        
        @keyframes productBounce {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }
        
        .completed-check {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.4);
            animation: checkAppear 0.5s ease-out 0.3s backwards;
        }
        
        @keyframes checkAppear {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(10deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        .completed-particles {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
        }
        
        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #2ecc71;
            border-radius: 50%;
            animation: particleExplode 1s ease-out forwards;
        }
        
        .particle:nth-child(1) { top: 50%; left: 50%; animation-delay: 0.4s; }
        .particle:nth-child(2) { top: 50%; left: 50%; animation-delay: 0.45s; }
        .particle:nth-child(3) { top: 50%; left: 50%; animation-delay: 0.5s; }
        .particle:nth-child(4) { top: 50%; left: 50%; animation-delay: 0.55s; }
        .particle:nth-child(5) { top: 50%; left: 50%; animation-delay: 0.6s; }
        .particle:nth-child(6) { top: 50%; left: 50%; animation-delay: 0.65s; }
        
        @keyframes particleExplode {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }
        
        .particle:nth-child(1) { --tx: -60px; --ty: -60px; }
        .particle:nth-child(2) { --tx: 60px; --ty: -60px; }
        .particle:nth-child(3) { --tx: -60px; --ty: 60px; }
        .particle:nth-child(4) { --tx: 60px; --ty: 60px; }
        .particle:nth-child(5) { --tx: 0; --ty: -80px; }
        .particle:nth-child(6) { --tx: 0; --ty: 80px; }
        
        .completed-text {
            text-align: center;
            animation: textPulse 1.5s ease-in-out infinite;
        }
        
        .completed-text h3 {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        
        .completed-text p {
            font-size: 14px;
            color: #27ae60;
            margin: 0;
            font-weight: 500;
        }
        
        /* Animación de Alquiler Cancelado */
        .cancelled-animation-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .cancelled-animation-overlay.compressed {
            position: relative;
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 30px;
            flex-shrink: 0;
            font-size: 28px;
            animation: pulse 2s infinite;
        }
        
        .cancelled-animation-overlay.compressed:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.6);
        }
        
        /* Tooltip para cancelado */
        .cancelled-animation-overlay.compressed::before {
            content: 'Alquiler cancelado';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 1000;
        }
        
        .cancelled-animation-overlay.compressed::after {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-2px);
            border: 5px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 1000;
        }
        
        .cancelled-animation-overlay.compressed:hover::before {
            opacity: 1;
            transform: translateX(-50%) translateY(-12px);
        }
        
        .cancelled-animation-overlay.compressed:hover::after {
            opacity: 1;
            transform: translateX(-50%) translateY(-6px);
        }
        
        body.dark-mode .cancelled-animation-overlay {
            background: rgba(26, 26, 46, 0.98);
        }
        
        body.dark-mode .cancelled-animation-overlay.compressed::before {
            background: rgba(255, 255, 255, 0.95);
            color: #1a1a2e;
        }
        
        body.dark-mode .cancelled-animation-overlay.compressed::after {
            border-top-color: rgba(255, 255, 255, 0.95);
        }
        
        .cancelled-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin-bottom: 20px;
        }
        
        .cancelled-product {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            animation: productShake 0.5s ease-out;
        }
        
        @keyframes productShake {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            10%, 30%, 50%, 70%, 90% { transform: translate(-50%, -50%) rotate(-5deg); }
            20%, 40%, 60%, 80% { transform: translate(-50%, -50%) rotate(5deg); }
        }
        
        .cancelled-cross {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            color: white;
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
            animation: crossAppear 0.5s ease-out 0.3s backwards;
        }
        
        @keyframes crossAppear {
            0% {
                transform: scale(0) rotate(180deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(-10deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        .cancelled-warning-particles {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
        }
        
        .warning-particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #e74c3c;
            border-radius: 50%;
            animation: warningParticleFloat 2s ease-in-out infinite;
        }
        
        .warning-particle:nth-child(1) {
            top: 20%;
            left: 20%;
            animation-delay: 0s;
        }
        
        .warning-particle:nth-child(2) {
            top: 20%;
            right: 20%;
            animation-delay: 0.3s;
        }
        
        .warning-particle:nth-child(3) {
            bottom: 20%;
            left: 20%;
            animation-delay: 0.6s;
        }
        
        .warning-particle:nth-child(4) {
            bottom: 20%;
            right: 20%;
            animation-delay: 0.9s;
        }
        
        @keyframes warningParticleFloat {
            0%, 100% {
                transform: translateY(0) scale(1);
                opacity: 0.6;
            }
            50% {
                transform: translateY(-15px) scale(1.2);
                opacity: 1;
            }
        }
        
        .cancelled-text {
            text-align: center;
            animation: textPulse 1.5s ease-in-out infinite;
        }
        
        .cancelled-text h3 {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        
        .cancelled-text p {
            font-size: 14px;
            color: #e74c3c;
            margin: 0;
            font-weight: 500;
        }
        
        .shipping-box-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin-bottom: 20px;
            transition: all 0.5s ease;
        }
        
        .compressed .shipping-box-container {
            width: 50px;
            height: 50px;
            margin-bottom: 0;
        }
        
        .shipping-box {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #8cbc00 0%, #037bc0 100%);
            border-radius: 12px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 10px 30px rgba(140, 188, 0, 0.3);
            animation: boxFloat 2s ease-in-out infinite;
            transition: all 0.5s ease;
        }
        
        .compressed .shipping-box {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            animation: boxFloatSmall 2s ease-in-out infinite;
        }
        
        @keyframes boxFloatSmall {
            0%, 100% { transform: translate(-50%, -50%) translateY(0) scale(1); }
            50% { transform: translate(-50%, -50%) translateY(-3px) scale(1.05); }
        }
        
        .shipping-box::before {
            content: '';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 15px;
            background: linear-gradient(135deg, #9dd100 0%, #048ed0 100%);
            border-radius: 4px 4px 0 0;
        }
        
        .shipping-box::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2px;
            height: 60%;
            background: rgba(255, 255, 255, 0.3);
        }
        
        .shipping-product {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 8px;
            position: absolute;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            animation: productDrop 2s ease-in-out infinite;
            transition: all 0.5s ease;
        }
        
        .compressed .shipping-product {
            display: none;
        }
        
        .shipping-tape {
            position: absolute;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.4);
            top: 50%;
            transform: translateY(-50%);
        }
        
        .shipping-text {
            text-align: center;
            animation: textPulse 1.5s ease-in-out infinite;
            transition: all 0.5s ease;
        }
        
        .compressed .shipping-text {
            display: none;
        }
        
        .shipping-text h3 {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #8cbc00, #037bc0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        
        .shipping-text p {
            font-size: 14px;
            color: #7f8c8d;
            margin: 0;
        }
        
        .shipping-dots {
            display: inline-flex;
            gap: 4px;
            margin-left: 4px;
        }
        
        .shipping-dots span {
            width: 4px;
            height: 4px;
            background: #8cbc00;
            border-radius: 50%;
            display: inline-block;
            animation: dotPulse 1.4s infinite;
        }
        
        .shipping-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .shipping-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes boxFloat {
            0%, 100% { transform: translate(-50%, -50%) translateY(0); }
            50% { transform: translate(-50%, -50%) translateY(-10px); }
        }
        
        @keyframes productDrop {
            0% { 
                top: -80px; 
                opacity: 1;
                transform: translateX(-50%) rotate(0deg);
            }
            50% { 
                top: 20px; 
                opacity: 0.5;
                transform: translateX(-50%) rotate(180deg);
            }
            100% { 
                top: -80px; 
                opacity: 1;
                transform: translateX(-50%) rotate(360deg);
            }
        }
        
        @keyframes textPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes dotPulse {
            0%, 80%, 100% { 
                opacity: 0;
                transform: scale(0);
            }
            40% { 
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* Estilos para Sección de Transporte - Minimalista y Moderna */
        .transporte-section {
            position: absolute;
            bottom: 20px;
            left: 25px;
            max-width: 280px;
            padding: 8px 12px;
            background: linear-gradient(135deg, rgba(140, 188, 0, 0.08), rgba(3, 123, 192, 0.08));
            border-radius: 8px;
            border: 1px solid rgba(140, 188, 0, 0.2);
            backdrop-filter: blur(10px);
            animation: slideIn 0.3s ease;
            z-index: 1;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .btn-proponer-transporte {
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(135deg, #8cbc00, #037bc0);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 2px 10px rgba(140, 188, 0, 0.2);
        }
        
        .btn-proponer-transporte:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(140, 188, 0, 0.3);
        }
        
        .btn-proponer-transporte i {
            font-size: 18px;
        }
        
        /* Botón deshabilitado */
        .btn-proponer-transporte.disabled {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            cursor: not-allowed;
            opacity: 0.6;
            box-shadow: none;
        }
        
        .btn-proponer-transporte.disabled:hover {
            transform: none;
            box-shadow: none;
        }
        
        .transporte-info-disabled {
            margin: 8px 0 0 0;
            padding: 8px;
            background: rgba(108, 117, 125, 0.1);
            border-radius: 6px;
            font-size: 11px;
            color: #6c757d;
            text-align: center;
            border-left: 3px solid #6c757d;
        }
        
        .transporte-info {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 0;
            background: transparent;
            border-radius: 0;
            margin-bottom: 0;
        }
        
        .transporte-info i {
            font-size: 16px;
            color: #8cbc00;
        }
        
        .transporte-info span {
            font-size: 13px;
            color: #2c3e50;
            font-weight: 500;
        }
        
        .transporte-info strong {
            color: #8cbc00;
            font-size: 14px;
            font-weight: 700;
        }
        
        .transporte-estado-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            background: rgba(255, 193, 7, 0.15);
            color: #856404;
            border-radius: 6px;
            font-size: 11px !important;
            font-weight: 600;
            margin-left: auto;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        .transporte-acciones {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .btn-aceptar-transporte,
        .btn-rechazar-transporte {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .btn-aceptar-transporte {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            box-shadow: 0 2px 10px rgba(46, 204, 113, 0.2);
        }
        
        .btn-aceptar-transporte:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }
        
        .btn-rechazar-transporte {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 2px 10px rgba(231, 76, 60, 0.2);
        }
        
        .btn-rechazar-transporte:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }
        
        .transporte-aceptado .transporte-info {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }
        
        .transporte-aceptado .transporte-info i {
            color: #27ae60;
        }
        
        .transporte-rechazado .transporte-info {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        
        .transporte-rechazado .transporte-info i {
            color: #e74c3c;
        }
        
        .btn-proponer-transporte-small {
            padding: 8px 16px;
            background: #8cbc00;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 10px;
        }
        
        .btn-proponer-transporte-small:hover {
            background: #7aa600;
            transform: translateY(-2px);
        }
        
        .transporte-propuesta-admin {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }
        
        /* Dark mode para transporte */
        body.dark-mode .transporte-section {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.1);
        }
        
        body.dark-mode .transporte-info-disabled {
            background: rgba(108, 117, 125, 0.2);
            color: #a0aec0;
            border-left-color: #6c757d;
        }
        
        body.dark-mode .transporte-info {
            background: rgba(255,255,255,0.08);
        }
        
        body.dark-mode .transporte-info span {
            color: #e0e0e0;
        }
        
        body.dark-mode .transporte-aceptado .transporte-info {
            background: rgba(39, 174, 96, 0.2);
            border-color: rgba(39, 174, 96, 0.3);
        }
        
        body.dark-mode .transporte-rechazado .transporte-info {
            background: rgba(231, 76, 60, 0.2);
            border-color: rgba(231, 76, 60, 0.3);
        }

        @media (max-width: 768px) {
            .alquiler-header { flex-direction: column; gap: 10px; align-items: flex-start; }
            .alquiler-details { grid-template-columns: 1fr; gap: 10px; }
            .alquiler-item { gap: 10px; }
            .alquiler-item-image { width: 45px; height: 45px; }
            .alquiler-total-amount { font-size: 20px; }
            .alquiler-summary { flex-direction: column; align-items: flex-start; }
            .alquiler-actions { width: 100%; }
            .btn-ver-detalles { width: 100%; justify-content: center; }
            .modal-content { max-height: 95vh; }
            .modal-header { padding: 20px; }
            .modal-body { padding: 20px; }
            .transporte-acciones { flex-direction: column; }
            .btn-aceptar-transporte, .btn-rechazar-transporte { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="container top-bar-content">
            <div class="contact-info">
                <span><i class="bi bi-telephone"></i> +57 300 123 4567</span>
                <span><i class="bi bi-envelope"></i> info@furniturerent.com</span>
            </div>
            <div class="social-links">
                <a href="#"><i class="bi bi-facebook"></i></a>
                <a href="#"><i class="bi bi-instagram"></i></a>
                <a href="#"><i class="bi bi-twitter"></i></a>
                <a href="#"><i class="bi bi-linkedin"></i></a>
            </div>
        </div>
    </div>

    <!-- Main Header -->
    <header class="main-header">
        <div class="container header-content">
            <a href="/" class="logo" aria-label="Ir al inicio">
                <i class="bi bi-house-heart"></i>
                <span>FU<strong>RENT</strong></span>
            </a>

            <nav class="nav-principal">
                <a href="/">Inicio</a>
                <a href="/about">Nosotros</a>
                <a href="/store">Alquilar</a>
                <a href="/contact">Contacto</a>
                <a th:if="${session.usuario}" href="/alquiler/mis-alquileres" class="active">
                    <i class="bi bi-calendar-check"></i> Mis alquileres
                </a>
                <a th:if="${session.usuario}" href="/favoritos">
                    <i class="bi bi-heart-fill"></i> Favoritos
                </a>
            </nav>
            
            <!-- Menú de usuario logueado -->
            <div class="user-menu" th:if="${session.usuario}">
                <div class="user-menu-toggle">
                    <div class="user-avatar" th:text="${#strings.substring(session.usuarioNombre, 0, 1)}">U</div>
                    <span th:text="${session.usuarioNombre}">Usuario</span>
                    <i class="bi bi-chevron-down"></i>
                </div>
                <div class="user-dropdown">
                    <div class="user-dropdown-header">
                        <strong th:text="${session.usuarioNombre}">Usuario</strong>
                        <p th:text="${session.usuario.correo}">email@example.com</p>
                    </div>
                    <div class="user-dropdown-menu">
                        <a href="/user-account">
                            <i class="bi bi-person"></i> Mi cuenta
                        </a>
                        <a href="/alquiler/mis-alquileres">
                            <i class="bi bi-calendar-check"></i> Mis alquileres
                        </a>
                        <div class="user-dropdown-divider"></div>
                        <a href="/logout" class="logout-link">
                            <i class="bi bi-box-arrow-right"></i> Cerrar sesión
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Botón de notificaciones de pago (campanita) -->
            <button class="payment-bell-btn" id="paymentBellBtn" aria-label="Notificaciones de pago" title="Notificaciones de pago">
                <i class="bi bi-bell-fill"></i>
                <span class="payment-notification-badge" id="paymentNotificationBadge" style="display: none;">0</span>
            </button>
            
            <!-- Botón del carrito -->
            <button class="cart-btn-header" onclick="toggleCart()" aria-label="Ver carrito" title="Ver carrito de compras">
                <i class="bi bi-cart3"></i>
                <span class="cart-badge" id="cartBadge" style="display: none;">0</span>
            </button>
            
            <!-- Botón de cambio de tema -->
            <button class="theme-toggle-btn" aria-label="Cambiar tema" title="Cambiar entre modo claro y oscuro">
                <i class="bi bi-moon-fill"></i>
            </button>
            
            <!-- Botón de login si no hay sesión -->
            <a th:unless="${session.usuario}" href="/login" class="login-btn">
                <i class="bi bi-person-circle"></i> Iniciar Sesión
            </a>
        </div>
    </header>

    <!-- Page Header -->
    <section class="page-header">
        <div class="page-header-overlay"></div>
        <div class="container">
            <h1 class="page-title">Mis alquileres</h1>
            <p class="page-breadcrumb"><a href="/">Inicio</a> / Mis alquileres</p>
        </div>
    </section>

    <!-- Alquileres Page -->
    <main class="alquileres-page">
        <div class="alquileres-container">
            <!-- Mensajes -->
            <div class="alert alert-success" th:if="${mensaje}">
                <i class="bi bi-check-circle"></i> <span th:text="${mensaje}"></span>
            </div>
            <div class="alert alert-error" th:if="${error}">
                <i class="bi bi-exclamation-circle"></i> <span th:text="${error}"></span>
            </div>

            <div class="alquileres-header">
                <h1><i class="bi bi-bag-check"></i> Mis alquileres de mobiliario</h1>
                <p>Historial completo de tus alquileres</p>
            </div>
            
            <!-- Barra de búsqueda y filtros -->
            <div class="search-filter-container" th:if="${alquileres != null && !alquileres.isEmpty()}">
                <div class="search-box">
                    <i class="bi bi-search"></i>
                    <input type="text" 
                           id="searchInput" 
                           placeholder="Buscar por ID, producto, dirección..." 
                           onkeyup="filtrarAlquileres()">
                </div>
                
                <div class="filters-row">
                    <div class="filter-group">
                        <label class="filter-label">Estado</label>
                        <select id="filterEstado" class="filter-select" onchange="filtrarAlquileres()">
                            <option value="">Todos los estados</option>
                            <option value="PENDIENTE">Pendiente</option>
                            <option value="CONFIRMADO">Confirmado</option>
                            <option value="EN_CURSO">En Curso</option>
                            <option value="COMPLETADO">Completado</option>
                            <option value="CANCELADO">Cancelado</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Fecha Desde</label>
                        <input type="date" 
                               id="filterFechaDesde" 
                               class="filter-input" 
                               onchange="filtrarAlquileres()">
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Fecha Hasta</label>
                        <input type="date" 
                               id="filterFechaHasta" 
                               class="filter-input" 
                               onchange="filtrarAlquileres()">
                    </div>
                </div>
                
                <div class="filter-actions">
                    <div class="results-count" id="resultsCount">
                        <i class="bi bi-funnel"></i>
                        Mostrando <strong id="countNumber">0</strong> de <strong id="totalNumber">0</strong> alquileres
                    </div>
                    <button class="btn-clear-filters" onclick="limpiarFiltros()">
                        <i class="bi bi-x-circle"></i> Limpiar Filtros
                    </button>
                </div>
            </div>

            <!-- Empty -->
            <div class="empty-alquileres" th:if="${alquileres == null || alquileres.isEmpty()}">
                <i class="bi bi-inbox"></i>
                <h2>No tienes alquileres aún</h2>
                <p>¡Comienza a alquilar mobiliario para tus eventos!</p>
                <a href="/store" class="btn-primary">Explorar Catálogo</a>
            </div>

            <!-- Mensaje sin resultados -->
            <div class="no-results" id="noResults">
                <i class="bi bi-search"></i>
                <h3>No se encontraron resultados</h3>
                <p>Intenta con otros criterios de búsqueda o filtros</p>
            </div>
            
            <!-- Alquileres List -->
            <div th:if="${alquileres != null && !alquileres.isEmpty()}">
            <div id="alquileresContainer">
                <div class="alquiler-card" th:each="alquiler, iterStat : ${alquileres}" 
                     th:attr="data-id=${alquiler.id},
                              data-estado=${alquiler.estado},
                              data-fecha=${#temporals.format(alquiler.fechaAlquiler, 'yyyy-MM-dd')},
                              data-productos=${#strings.listJoin(alquiler.items.![nombreProducto], '|')},
                              data-direccion=${alquiler.direccionEntrega},
                              data-cliente=${alquiler.usuarioNombre}">
                    <div class="alquiler-header">
                        <div>
                            <div class="alquiler-id">
                                <i class="bi bi-receipt"></i> Alquiler #<span th:text="${alquiler.id}">ID</span>
                            </div>
                            <div class="alquiler-date">
                                <i class="bi bi-calendar"></i> 
                                <span th:text="${#temporals.format(alquiler.fechaAlquiler, 'dd/MM/yyyy HH:mm')}">Fecha</span>
                            </div>
                        </div>
                        <div class="status-container" style="display: flex; align-items: center;">
                            <span class="alquiler-status" 
                                  th:classappend="${'status-' + #strings.toLowerCase(alquiler.estado)}"
                                  th:text="${alquiler.estado}">
                                PENDIENTE
                            </span>
                        </div>
                    </div>

                    <!-- Vista compacta -->
                    <div class="alquiler-summary">
                        <div class="alquiler-info-compact">
                            <div class="detail-group">
                                <span class="detail-label">Período de Alquiler</span>
                                <span class="detail-value">
                                    <span th:text="${#temporals.format(alquiler.fechaInicio, 'dd/MM/yyyy')}"></span> - 
                                    <span th:text="${#temporals.format(alquiler.fechaFin, 'dd/MM/yyyy')}"></span>
                                </span>
                            </div>
                            <div class="alquiler-items-count">
                                <i class="bi bi-box-seam"></i>
                                <span th:text="${#lists.size(alquiler.items)} + ' producto(s)'">0 producto(s)</span>
                            </div>
                        </div>
                        
                        <div class="alquiler-actions">
                            <div class="alquiler-price-compact">
                                <div class="price-label">Total</div>
                                <div class="price-value" 
                                     th:text="'$' + ${#numbers.formatDecimal(alquiler.total, 1, 'POINT', 2, 'COMMA')}">
                                    $0
                                </div>
                            </div>
                            
                            <!-- Sección de Transporte - Siempre visible -->
                            <div class="transporte-section" th:attr="data-alquiler-id=${alquiler.id}">
                                <!-- Estado: NULL - Usuario NO solicitó transporte (DESHABILITADO) -->
                                <div th:if="${alquiler.estadoTransporte == null}" 
                                     class="transporte-deshabilitada">
                                    <button class="btn-proponer-transporte disabled" disabled>
                                        <i class="bi bi-truck"></i> Transporte no solicitado
                                    </button>
                                    <p class="transporte-info-disabled">No solicitaste transporte al crear este alquiler</p>
                                </div>
                                
                                <!-- Estado: PENDIENTE - Usuario puede proponer (HABILITADO) -->
                                <div th:if="${alquiler.estadoTransporte == 'PENDIENTE'}" 
                                     class="transporte-pendiente">
                                    <button class="btn-proponer-transporte" 
                                            th:attr="data-alquiler-id=${alquiler.id}"
                                            onclick="mostrarFormularioTransporte(this.getAttribute('data-alquiler-id'))">
                                        <i class="bi bi-truck"></i> Proponer Costo de Transporte
                                    </button>
                                </div>
                                
                                <!-- Estado: PROPUESTA_USUARIO - Esperando respuesta del admin -->
                                <div th:if="${alquiler.estadoTransporte == 'PROPUESTA_USUARIO'}" 
                                     class="transporte-propuesta-usuario">
                                    <div class="transporte-info">
                                        <i class="bi bi-clock-history"></i>
                                        <span>Tu propuesta: <strong th:text="'$' + ${alquiler.costoTransporteUsuario}">$0</strong></span>
                                        <span class="transporte-estado-badge">Esperando respuesta del administrador</span>
                                    </div>
                                </div>
                                
                                <!-- Estado: PROPUESTA_ADMIN - Usuario puede aceptar o rechazar -->
                                <div th:if="${alquiler.estadoTransporte == 'PROPUESTA_ADMIN'}" 
                                     class="transporte-propuesta-admin">
                                    <div class="transporte-info">
                                        <i class="bi bi-exclamation-circle"></i>
                                        <span>Contrapropuesta del admin: <strong th:text="'$' + ${alquiler.costoTransporteAdmin}">$0</strong></span>
                                    </div>
                                    <div class="transporte-acciones">
                                        <button class="btn-aceptar-transporte" 
                                                th:attr="data-alquiler-id=${alquiler.id}"
                                                onclick="aceptarTransporteAdmin(this.getAttribute('data-alquiler-id'))">
                                            <i class="bi bi-check-circle"></i> Aceptar
                                        </button>
                                        <button class="btn-rechazar-transporte" 
                                                th:attr="data-alquiler-id=${alquiler.id}"
                                                onclick="rechazarTransporteAdmin(this.getAttribute('data-alquiler-id'))">
                                            <i class="bi bi-x-circle"></i> Rechazar
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Estado: ACEPTADO - Transporte acordado -->
                                <div th:if="${alquiler.estadoTransporte == 'ACEPTADO'}" 
                                     class="transporte-aceptado">
                                    <div class="transporte-info">
                                        <i class="bi bi-check-circle-fill"></i>
                                        <span>Transporte acordado: <strong th:text="'$' + ${alquiler.costoTransporteAceptado}">$0</strong></span>
                                    </div>
                                </div>
                                
                                <!-- Estado: RECHAZADO -->
                                <div th:if="${alquiler.estadoTransporte == 'RECHAZADO'}" 
                                     class="transporte-rechazado">
                                    <div class="transporte-info">
                                        <i class="bi bi-x-circle-fill"></i>
                                        <span>Negociación de transporte cancelada</span>
                                    </div>
                                    <button class="btn-proponer-transporte-small" 
                                            th:attr="data-alquiler-id=${alquiler.id}"
                                            onclick="mostrarFormularioTransporte(this.getAttribute('data-alquiler-id'))">
                                        <i class="bi bi-arrow-repeat"></i> Proponer Nuevamente
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Botón Cancelar (solo visible si el estado es PENDIENTE) -->
                            <button th:if="${alquiler.estado == 'PENDIENTE'}"
                                    class="btn-cancelar" 
                                    th:attr="data-alquiler-id=${alquiler.id}"
                                    onclick="confirmarCancelacion(this.getAttribute('data-alquiler-id'))">
                                <i class="bi bi-x-circle"></i> Cancelar
                            </button>
                            
                            <button class="btn-ver-detalles" 
                                    th:onclick="'verDetallesAlquiler(' + ${iterStat.index} + ')'">
                                <i class="bi bi-eye"></i> Ver Detalles
                            </button>
                            
                            <!-- Botón Dejar Reseña (solo visible si el estado es COMPLETADO) -->
                            <button th:if="${alquiler.estado == 'COMPLETADO'}"
                                    class="btn-dejar-resena" 
                                    th:attr="data-alquiler-id=${alquiler.id}"
                                    th:onclick="'abrirModalResenaDesdeAlquiler(' + ${iterStat.index} + ')'">
                                <i class="bi bi-star-fill"></i> Dejar Reseña
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Botón ver más/menos -->
            <div class="ver-mas-container" id="verMasContainer" style="display: none;">
                <button class="btn-ver-mas" id="btnVerMas" onclick="toggleVerMas()">
                    <span id="verMasTexto">Ver más alquileres</span>
                    <i class="bi bi-chevron-down" id="verMasIcono"></i>
                </button>
            </div>
            </div>
            
            <!-- Modal para detalles del alquiler -->
            <div class="modal-overlay" id="modalDetalles" onclick="cerrarModal(event)">
                <div class="modal-content" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h2><i class="bi bi-receipt-cutoff"></i> Detalles del Alquiler</h2>
                        <button class="modal-close" onclick="cerrarModal()">
                            <i class="bi bi-x"></i>
                        </button>
                    </div>
                    <div class="modal-body" id="modalBody">
                        <!-- El contenido se cargará dinámicamente -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-main">
            <div class="grid-footer container">
                <div class="footer-column">
                    <div class="footer-logo">
                        <i class="bi bi-house-heart"></i>
                        <span>FU<strong>RENT</strong></span>
                    </div>
                    <p class="footer-description">Transformamos tus eventos con mobiliario de alta calidad y servicio excepcional.</p>
                    <div class="footer-social">
                        <a href="#"><i class="bi bi-facebook"></i></a>
                        <a href="#"><i class="bi bi-instagram"></i></a>
                        <a href="#"><i class="bi bi-twitter"></i></a>
                        <a href="#"><i class="bi bi-linkedin"></i></a>
                    </div>
                </div>

                <div class="footer-column">
                    <h3>Categorías</h3>
                    <nav class="footer-menu">
                        <a href="#"><i class="bi bi-chevron-right"></i> Eventos Corporativos</a>
                        <a href="#"><i class="bi bi-chevron-right"></i> Bodas y Celebraciones</a>
                        <a href="#"><i class="bi bi-chevron-right"></i> Fiestas Infantiles</a>
                        <a href="#"><i class="bi bi-chevron-right"></i> Quinceañeros</a>    
                    </nav>
                </div>

                <div class="footer-column">
                    <h3>Sobre nosotros</h3>
                    <nav class="footer-menu">
                        <a href="/about"><i class="bi bi-chevron-right"></i> Nuestra historia</a>
                        <a href="#"><i class="bi bi-chevron-right"></i> Misión y visión</a>
                        <a href="#"><i class="bi bi-chevron-right"></i> Política de Privacidad</a>
                        <a href="#"><i class="bi bi-chevron-right"></i> Términos y Condiciones</a>
                    </nav>
                </div>

                <div class="footer-column">
                    <h3>Contacto</h3>
                    <nav class="footer-menu">
                        <a href="#"><i class="bi bi-telephone"></i> +57 300 123 4567</a>
                        <a href="#"><i class="bi bi-envelope"></i> info@furniturerent.com</a>
                        <a href="#"><i class="bi bi-geo-alt"></i> Bogotá, Colombia</a>
                        <a href="#"><i class="bi bi-clock"></i> Lun - Sáb: 8am - 6pm</a>
                    </nav>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom">
            <div class="container">
                <p class="copyright">© 2024 FURENT. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script th:inline="javascript">
        // Cargar contador al iniciar
        document.addEventListener('DOMContentLoaded', actualizarContadorCarrito);
        
        // Datos de los alquileres en JavaScript
        const alquileresData = /*[[${alquileres}]]*/ [];
        
        // Función para ver detalles del alquiler
        function verDetallesAlquiler(index) {
            const alquiler = alquileresData[index];
            if (!alquiler) return;
            
            const modalBody = document.getElementById('modalBody');
            const fechaAlquiler = new Date(alquiler.fechaAlquiler);
            const fechaInicio = new Date(alquiler.fechaInicio);
            const fechaFin = new Date(alquiler.fechaFin);
            
            let itemsHtml = '';
            alquiler.items.forEach(item => {
                itemsHtml += `
                    <div class="alquiler-item">
                        <div class="alquiler-item-image">
                            <img src="${item.imagenProducto}" alt="${item.nombreProducto}">
                        </div>
                        <div class="alquiler-item-info">
                            <div class="alquiler-item-name">${item.nombreProducto}</div>
                            <div class="alquiler-item-quantity">
                                Cantidad: <span>${item.cantidad}</span> | 
                                Días: <span>${item.diasAlquiler}</span>
                            </div>
                        </div>
                        <div class="alquiler-item-price">
                            $${item.subtotal.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                        </div>
                    </div>
                `;
            });
            
            let notasHtml = '';
            if (alquiler.notasAdicionales) {
                notasHtml = `
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="bi bi-chat-left-text"></i> Notas Adicionales
                        </div>
                        <div class="detail-value">${alquiler.notasAdicionales}</div>
                    </div>
                `;
            }
            
            modalBody.innerHTML = `
                <div class="modal-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <div class="alquiler-id" style="margin-bottom: 8px;">
                                <i class="bi bi-receipt"></i> Alquiler #${alquiler.id}
                            </div>
                            <div class="alquiler-date">
                                <i class="bi bi-calendar"></i> ${formatDate(fechaAlquiler)}
                            </div>
                        </div>
                        <span class="alquiler-status status-${alquiler.estado.toLowerCase()}">
                            ${alquiler.estado}
                        </span>
                    </div>
                </div>
                
                <div class="modal-section">
                    <div class="modal-section-title">
                        <i class="bi bi-info-circle"></i> Información General
                    </div>
                    <div class="alquiler-details">
                        <div class="detail-group">
                            <span class="detail-label">Cliente</span>
                            <span class="detail-value">${alquiler.usuarioNombre}</span>
                        </div>
                        <div class="detail-group">
                            <span class="detail-label">Correo</span>
                            <span class="detail-value">${alquiler.usuarioCorreo}</span>
                        </div>
                        <div class="detail-group">
                            <span class="detail-label">Dirección de Entrega</span>
                            <span class="detail-value">${alquiler.direccionEntrega}</span>
                        </div>
                    </div>
                </div>
                
                <div class="modal-section">
                    <div class="modal-section-title">
                        <i class="bi bi-calendar-range"></i> Fechas del Alquiler
                    </div>
                    <div class="alquiler-details">
                        <div class="detail-group">
                            <span class="detail-label">Fecha de Inicio</span>
                            <span class="detail-value">${formatDate(fechaInicio)}</span>
                        </div>
                        <div class="detail-group">
                            <span class="detail-label">Fecha de Fin</span>
                            <span class="detail-value">${formatDate(fechaFin)}</span>
                        </div>
                    </div>
                </div>
                
                ${notasHtml}
                
                <div class="modal-section">
                    <div class="modal-section-title">
                        <i class="bi bi-box-seam"></i> Productos (${alquiler.items.length})
                    </div>
                    <div class="alquiler-items">
                        ${itemsHtml}
                    </div>
                </div>
                
                <div class="alquiler-total">
                    <span class="alquiler-total-label">Total del Alquiler:</span>
                    <span class="alquiler-total-amount">$${alquiler.total.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
                </div>
            `;
            
            // Mostrar modal
            const modal = document.getElementById('modalDetalles');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        // Función para cerrar modal
        function cerrarModal(event) {
            if (!event || event.target.id === 'modalDetalles') {
                const modal = document.getElementById('modalDetalles');
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }
        
        // Función auxiliar para formatear fechas
        function formatDate(date) {
            const options = { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit', 
                hour: '2-digit', 
                minute: '2-digit' 
            };
            return date.toLocaleString('es-CO', options);
        }
        
        // Cerrar modal con tecla ESC
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                cerrarModal();
            }
        });
        
        // Función para filtrar alquileres
        function filtrarAlquileres() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filterEstado = document.getElementById('filterEstado').value;
            const filterFechaDesde = document.getElementById('filterFechaDesde').value;
            const filterFechaHasta = document.getElementById('filterFechaHasta').value;
            
            const cards = document.querySelectorAll('.alquiler-card');
            let visibleCount = 0;
            
            // Resetear el estado de "ver más"
            mostrandoTodos = false;
            const btn = document.getElementById('btnVerMas');
            const texto = document.getElementById('verMasTexto');
            const icono = document.getElementById('verMasIcono');
            if (btn) {
                texto.textContent = 'Ver Más Alquileres';
                icono.classList.remove('bi-chevron-up');
                icono.classList.add('bi-chevron-down');
                btn.classList.remove('ver-menos');
            }
            
            cards.forEach(card => {
                // Remover clase hidden primero
                card.classList.remove('hidden');
                
                const id = card.getAttribute('data-id').toLowerCase();
                const estado = card.getAttribute('data-estado');
                const fecha = card.getAttribute('data-fecha');
                const productos = card.getAttribute('data-productos').toLowerCase();
                const direccion = card.getAttribute('data-direccion').toLowerCase();
                const cliente = card.getAttribute('data-cliente').toLowerCase();
                
                // Filtro de búsqueda
                const matchSearch = searchTerm === '' || 
                    id.includes(searchTerm) ||
                    productos.includes(searchTerm) ||
                    direccion.includes(searchTerm) ||
                    cliente.includes(searchTerm);
                
                // Filtro de estado
                const matchEstado = filterEstado === '' || estado === filterEstado;
                
                // Filtro de fecha desde
                const matchFechaDesde = filterFechaDesde === '' || fecha >= filterFechaDesde;
                
                // Filtro de fecha hasta
                const matchFechaHasta = filterFechaHasta === '' || fecha <= filterFechaHasta;
                
                // Mostrar u ocultar tarjeta
                if (matchSearch && matchEstado && matchFechaDesde && matchFechaHasta) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Actualizar contador
            document.getElementById('countNumber').textContent = visibleCount;
            document.getElementById('totalNumber').textContent = cards.length;
            
            // Mostrar mensaje si no hay resultados
            const noResults = document.getElementById('noResults');
            if (visibleCount === 0) {
                noResults.classList.add('show');
            } else {
                noResults.classList.remove('show');
            }
            
            // Actualizar vista de Ver Más/Menos
            actualizarVistaAlquileres();
        }
        
        // Función para limpiar filtros
        function limpiarFiltros() {
            document.getElementById('searchInput').value = '';
            document.getElementById('filterEstado').value = '';
            document.getElementById('filterFechaDesde').value = '';
            document.getElementById('filterFechaHasta').value = '';
            mostrandoTodos = false;
            filtrarAlquileres();
        }
        
        // Variables para controlar Ver Más/Menos
        let mostrandoTodos = false;
        const ALQUILERES_INICIALES = 3;
        
        // Función para mostrar/ocultar alquileres
        function actualizarVistaAlquileres() {
            const cards = document.querySelectorAll('.alquiler-card');
            const cardsVisibles = Array.from(cards).filter(card => card.style.display !== 'none');
            
            if (cardsVisibles.length > ALQUILERES_INICIALES) {
                document.getElementById('verMasContainer').style.display = 'block';
                
                if (!mostrandoTodos) {
                    cardsVisibles.forEach((card, index) => {
                        if (index >= ALQUILERES_INICIALES) {
                            card.classList.add('hidden');
                        }
                    });
                }
            } else {
                document.getElementById('verMasContainer').style.display = 'none';
            }
        }
        
        // Función para toggle Ver Más/Menos
        function toggleVerMas() {
            const cards = document.querySelectorAll('.alquiler-card');
            const cardsVisibles = Array.from(cards).filter(card => card.style.display !== 'none');
            const btn = document.getElementById('btnVerMas');
            const texto = document.getElementById('verMasTexto');
            const icono = document.getElementById('verMasIcono');
            
            mostrandoTodos = !mostrandoTodos;
            
            if (mostrandoTodos) {
                // Mostrar todos
                cardsVisibles.forEach(card => {
                    card.classList.remove('hidden');
                });
                texto.textContent = 'Ver Menos';
                icono.classList.remove('bi-chevron-down');
                icono.classList.add('bi-chevron-up');
                btn.classList.add('ver-menos');
                
                // Scroll suave hacia arriba
                setTimeout(() => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 300);
            } else {
                // Mostrar solo los primeros 3
                cardsVisibles.forEach((card, index) => {
                    if (index >= ALQUILERES_INICIALES) {
                        card.classList.add('hidden');
                    }
                });
                texto.textContent = 'Ver Más Alquileres';
                icono.classList.remove('bi-chevron-up');
                icono.classList.add('bi-chevron-down');
                btn.classList.remove('ver-menos');
                
                // Scroll suave hacia los alquileres
                document.getElementById('alquileresContainer').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        // Inicializar contador al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.alquiler-card');
            if (cards.length > 0) {
                document.getElementById('countNumber').textContent = cards.length;
                document.getElementById('totalNumber').textContent = cards.length;
                
                // Mostrar solo los primeros 3 alquileres inicialmente
                actualizarVistaAlquileres();
            }
            
            // Detectar cambios de estado
            detectarCambiosEstado();
        });
        
        // Detectar cambios de estado
        function detectarCambiosEstado() {
            const estadosPrevios = JSON.parse(localStorage.getItem('estadosAlquileres') || '{}');
            const estadosActuales = {};
            let alquileresPreparando = JSON.parse(localStorage.getItem('alquileresPreparando') || '[]');
            let alquileresEnCurso = JSON.parse(localStorage.getItem('alquileresEnCurso') || '[]');
            let alquileresCompletados = JSON.parse(localStorage.getItem('alquileresCompletados') || '[]');
            let alquileresCancelados = JSON.parse(localStorage.getItem('alquileresCancelados') || '[]');
            
            alquileresData.forEach(alquiler => {
                estadosActuales[alquiler.id] = alquiler.estado;
                
                // Si cambió de PENDIENTE a CONFIRMADO, mostrar animación de preparando envío
                if (estadosPrevios[alquiler.id] === 'PENDIENTE' && alquiler.estado === 'CONFIRMADO') {
                    const card = document.querySelector(`.alquiler-card[data-id="${alquiler.id}"]`);
                    if (card) {
                        mostrarAnimacionEnvio(card, alquiler.id, true);
                        if (!alquileresPreparando.includes(alquiler.id)) {
                            alquileresPreparando.push(alquiler.id);
                        }
                    }
                }
                // Si está en CONFIRMADO y está en la lista, mostrar indicador comprimido
                else if (alquiler.estado === 'CONFIRMADO' && alquileresPreparando.includes(alquiler.id)) {
                    const card = document.querySelector(`.alquiler-card[data-id="${alquiler.id}"]`);
                    if (card) {
                        mostrarAnimacionEnvio(card, alquiler.id, false);
                    }
                }
                // Si cambió de CONFIRMADO a EN_CURSO, mostrar animación de entrega
                else if (estadosPrevios[alquiler.id] === 'CONFIRMADO' && (alquiler.estado === 'EN CURSO' || alquiler.estado === 'ENCURSO' || alquiler.estado === 'EN_CURSO')) {
                    const card = document.querySelector(`.alquiler-card[data-id="${alquiler.id}"]`);
                    if (card) {
                        mostrarAnimacionEntrega(card, alquiler.id, true);
                        if (!alquileresEnCurso.includes(alquiler.id)) {
                            alquileresEnCurso.push(alquiler.id);
                        }
                    }
                }
                // Si está en EN_CURSO (cualquier formato)
                else if (alquiler.estado === 'EN CURSO' || alquiler.estado === 'ENCURSO' || alquiler.estado === 'EN_CURSO') {
                    const card = document.querySelector(`.alquiler-card[data-id="${alquiler.id}"]`);
                    if (card) {
                        // Si ya está en la lista, mostrar indicador comprimido
                        if (alquileresEnCurso.includes(alquiler.id)) {
                            mostrarAnimacionEntrega(card, alquiler.id, false);
                        } 
                        // Si no está en la lista pero ya está en EN_CURSO, agregarlo y mostrar comprimido
                        else {
                            alquileresEnCurso.push(alquiler.id);
                            mostrarAnimacionEntrega(card, alquiler.id, false);
                        }
                    }
                }
                // Si cambió de EN_CURSO a COMPLETADO, mostrar animación de completado
                else if ((estadosPrevios[alquiler.id] === 'EN_CURSO' || estadosPrevios[alquiler.id] === 'EN CURSO' || estadosPrevios[alquiler.id] === 'ENCURSO') && alquiler.estado === 'COMPLETADO') {
                    const card = document.querySelector(`.alquiler-card[data-id="${alquiler.id}"]`);
                    if (card) {
                        mostrarAnimacionCompletado(card, alquiler.id, true);
                        if (!alquileresCompletados.includes(alquiler.id)) {
                            alquileresCompletados.push(alquiler.id);
                        }
                    }
                }
                // Si está en COMPLETADO
                else if (alquiler.estado === 'COMPLETADO') {
                    const card = document.querySelector(`.alquiler-card[data-id="${alquiler.id}"]`);
                    if (card) {
                        if (alquileresCompletados.includes(alquiler.id)) {
                            mostrarAnimacionCompletado(card, alquiler.id, false);
                        } else {
                            alquileresCompletados.push(alquiler.id);
                            mostrarAnimacionCompletado(card, alquiler.id, false);
                        }
                    }
                }
                // Si cambió a CANCELADO, mostrar animación de cancelado
                else if (estadosPrevios[alquiler.id] && estadosPrevios[alquiler.id] !== 'CANCELADO' && alquiler.estado === 'CANCELADO') {
                    const card = document.querySelector(`.alquiler-card[data-id="${alquiler.id}"]`);
                    if (card) {
                        mostrarAnimacionCancelado(card, alquiler.id, true);
                        if (!alquileresCancelados.includes(alquiler.id)) {
                            alquileresCancelados.push(alquiler.id);
                        }
                    }
                }
                // Si está en CANCELADO
                else if (alquiler.estado === 'CANCELADO') {
                    const card = document.querySelector(`.alquiler-card[data-id="${alquiler.id}"]`);
                    if (card) {
                        if (alquileresCancelados.includes(alquiler.id)) {
                            mostrarAnimacionCancelado(card, alquiler.id, false);
                        } else {
                            alquileresCancelados.push(alquiler.id);
                            mostrarAnimacionCancelado(card, alquiler.id, false);
                        }
                    }
                }
            });
            
            // Limpiar alquileres que ya no existen
            const idsActuales = alquileresData.map(a => a.id);
            alquileresPreparando = alquileresPreparando.filter(id => idsActuales.includes(id));
            alquileresEnCurso = alquileresEnCurso.filter(id => idsActuales.includes(id));
            alquileresCompletados = alquileresCompletados.filter(id => idsActuales.includes(id));
            alquileresCancelados = alquileresCancelados.filter(id => idsActuales.includes(id));
            
            localStorage.setItem('estadosAlquileres', JSON.stringify(estadosActuales));
            localStorage.setItem('alquileresPreparando', JSON.stringify(alquileresPreparando));
            localStorage.setItem('alquileresEnCurso', JSON.stringify(alquileresEnCurso));
            localStorage.setItem('alquileresCompletados', JSON.stringify(alquileresCompletados));
            localStorage.setItem('alquileresCancelados', JSON.stringify(alquileresCancelados));
        }
        
        // Mostrar animación de preparando envío
        function mostrarAnimacionEnvio(card, alquilerId, mostrarCompleta) {
            // Buscar el contenedor de estado
            const statusContainer = card.querySelector('.status-container');
            if (!statusContainer) return;
            
            // Verificar si ya existe el indicador (evitar duplicados)
            const existingIndicator = statusContainer.querySelector('.shipping-animation-overlay');
            if (existingIndicator) return;
            
            const indicator = document.createElement('div');
            indicator.className = 'shipping-animation-overlay';
            indicator.title = 'Preparando envío - Pedido confirmado';
            indicator.setAttribute('data-alquiler-id', alquilerId);
            indicator.setAttribute('data-persistent', 'true'); // Marcar como persistente
            
            if (mostrarCompleta) {
                // Mostrar animación completa primero como overlay absoluto
                indicator.innerHTML = `
                    <div class="shipping-box-container">
                        <div class="shipping-product">🪑</div>
                        <div class="shipping-box"><div class="shipping-tape"></div></div>
                    </div>
                    <div class="shipping-text">
                        <h3>Preparando envío</h3>
                        <p>Tu pedido está siendo empacado<span class="shipping-dots"><span></span><span></span><span></span></span></p>
                    </div>
                `;
                
                // Agregar como overlay absoluto primero
                indicator.style.position = 'absolute';
                card.appendChild(indicator);
                
                // Después de 4 segundos, mover al contenedor de estado y comprimir
                setTimeout(() => {
                    indicator.remove();
                    indicator.style.position = 'relative';
                    indicator.classList.add('compressed');
                    indicator.innerHTML = '📦'; // Agregar emoji directamente
                    statusContainer.insertBefore(indicator, statusContainer.firstChild);
                }, 4000);
            } else {
                // Mostrar directamente comprimido en el contenedor de estado
                indicator.classList.add('compressed');
                indicator.innerHTML = '📦'; // Agregar emoji directamente
                statusContainer.insertBefore(indicator, statusContainer.firstChild);
            }
        }
        
        // Mostrar animación de entrega en curso
        function mostrarAnimacionEntrega(card, alquilerId, mostrarCompleta) {
            // Buscar el contenedor de estado
            const statusContainer = card.querySelector('.status-container');
            if (!statusContainer) return;
            
            // Verificar si ya existe el indicador (evitar duplicados)
            const existingIndicator = statusContainer.querySelector('.delivery-animation-overlay');
            if (existingIndicator) return;
            
            const indicator = document.createElement('div');
            indicator.className = 'delivery-animation-overlay';
            indicator.title = 'Entrega en curso';
            indicator.setAttribute('data-alquiler-id', alquilerId);
            indicator.setAttribute('data-persistent', 'true'); // Marcar como persistente
            
            if (mostrarCompleta) {
                // Mostrar animación completa primero como overlay absoluto
                indicator.innerHTML = `
                    <div class="delivery-truck-container">
                        <div class="delivery-road"></div>
                        <div class="delivery-smoke"></div>
                        <div class="delivery-smoke"></div>
                        <div class="delivery-smoke"></div>
                        <div class="delivery-truck">🚚</div>
                    </div>
                    <div class="delivery-text">
                        <h3>Entrega en curso</h3>
                        <p>Tu pedido está en camino<span class="shipping-dots"><span></span><span></span><span></span></span></p>
                    </div>
                `;
                
                // Agregar como overlay absoluto primero
                indicator.style.position = 'absolute';
                card.appendChild(indicator);
                
                // Después de 4 segundos, mover al contenedor de estado y comprimir
                setTimeout(() => {
                    indicator.remove();
                    indicator.style.position = 'relative';
                    indicator.classList.add('compressed');
                    indicator.innerHTML = '🚚'; // Agregar emoji de camión
                    statusContainer.insertBefore(indicator, statusContainer.firstChild);
                }, 4000);
            } else {
                // Mostrar directamente comprimido en el contenedor de estado
                indicator.classList.add('compressed');
                indicator.innerHTML = '🚚'; // Agregar emoji de camión
                statusContainer.insertBefore(indicator, statusContainer.firstChild);
            }
        }
        
        // Mostrar animación de entrega completada
        function mostrarAnimacionCompletado(card, alquilerId, mostrarCompleta) {
            // Buscar el contenedor de estado
            const statusContainer = card.querySelector('.status-container');
            if (!statusContainer) return;
            
            // Verificar si ya existe el indicador (evitar duplicados)
            const existingIndicator = statusContainer.querySelector('.completed-animation-overlay');
            if (existingIndicator) return;
            
            const indicator = document.createElement('div');
            indicator.className = 'completed-animation-overlay';
            indicator.title = 'Entrega completada';
            indicator.setAttribute('data-alquiler-id', alquilerId);
            indicator.setAttribute('data-persistent', 'true');
            
            if (mostrarCompleta) {
                // Mostrar animación completa primero como overlay absoluto
                indicator.innerHTML = `
                    <div class="completed-check-container">
                        <div class="completed-particles">
                            <div class="particle"></div>
                            <div class="particle"></div>
                            <div class="particle"></div>
                            <div class="particle"></div>
                            <div class="particle"></div>
                            <div class="particle"></div>
                        </div>
                        <div class="completed-product">🪑</div>
                        <div class="completed-check">✓</div>
                    </div>
                    <div class="completed-text">
                        <h3>¡Entrega completada!</h3>
                        <p>El alquiler fue entregado con éxito</p>
                    </div>
                `;
                
                // Agregar como overlay absoluto primero
                indicator.style.position = 'absolute';
                card.appendChild(indicator);
                
                // Después de 4 segundos, mover al contenedor de estado y comprimir
                setTimeout(() => {
                    indicator.remove();
                    indicator.style.position = 'relative';
                    indicator.classList.add('compressed');
                    indicator.innerHTML = '✓';
                    statusContainer.insertBefore(indicator, statusContainer.firstChild);
                }, 4000);
            } else {
                // Mostrar directamente comprimido en el contenedor de estado
                indicator.classList.add('compressed');
                indicator.innerHTML = '✓';
                statusContainer.insertBefore(indicator, statusContainer.firstChild);
            }
        }
        
        // Mostrar animación de alquiler cancelado
        function mostrarAnimacionCancelado(card, alquilerId, mostrarCompleta) {
            // Buscar el contenedor de estado
            const statusContainer = card.querySelector('.status-container');
            if (!statusContainer) return;
            
            // Verificar si ya existe el indicador (evitar duplicados)
            const existingIndicator = statusContainer.querySelector('.cancelled-animation-overlay');
            if (existingIndicator) return;
            
            const indicator = document.createElement('div');
            indicator.className = 'cancelled-animation-overlay';
            indicator.title = 'Alquiler cancelado';
            indicator.setAttribute('data-alquiler-id', alquilerId);
            indicator.setAttribute('data-persistent', 'true');
            
            if (mostrarCompleta) {
                // Mostrar animación completa primero como overlay absoluto
                indicator.innerHTML = `
                    <div class="cancelled-container">
                        <div class="cancelled-warning-particles">
                            <div class="warning-particle"></div>
                            <div class="warning-particle"></div>
                            <div class="warning-particle"></div>
                            <div class="warning-particle"></div>
                        </div>
                        <div class="cancelled-product">🪑</div>
                        <div class="cancelled-cross">✕</div>
                    </div>
                    <div class="cancelled-text">
                        <h3>Alquiler cancelado</h3>
                        <p>El alquiler fue cancelado</p>
                    </div>
                `;
                
                // Agregar como overlay absoluto primero
                indicator.style.position = 'absolute';
                card.appendChild(indicator);
                
                // Después de 4 segundos, mover al contenedor de estado y comprimir
                setTimeout(() => {
                    indicator.remove();
                    indicator.style.position = 'relative';
                    indicator.classList.add('compressed');
                    indicator.innerHTML = '✕';
                    statusContainer.insertBefore(indicator, statusContainer.firstChild);
                }, 4000);
            } else {
                // Mostrar directamente comprimido en el contenedor de estado
                indicator.classList.add('compressed');
                indicator.innerHTML = '✕';
                statusContainer.insertBefore(indicator, statusContainer.firstChild);
            }
        }
        
        // Función para confirmar cancelación del alquiler
        function confirmarCancelacion(alquilerId) {
            Swal.fire({
                title: '¿Cancelar alquiler?',
                text: "Esta acción no se puede deshacer. El stock de los productos será restaurado.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc3545',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Sí, cancelar',
                cancelButtonText: 'No, mantener',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    cancelarAlquiler(alquilerId);
                }
            });
        }
        
        // Función para cancelar el alquiler
        function cancelarAlquiler(alquilerId) {
            // Mostrar loading
            Swal.fire({
                title: 'Cancelando alquiler...',
                text: 'Por favor espera',
                allowOutsideClick: false,
                allowEscapeKey: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            
            // Crear formulario y enviarlo
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/alquiler/cancelar/' + alquilerId;
            
            // Agregar CSRF token si existe
            const csrfToken = document.querySelector('meta[name="_csrf"]');
            const csrfHeader = document.querySelector('meta[name="_csrf_header"]');
            if (csrfToken && csrfHeader) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = csrfToken.getAttribute('content');
                input.value = csrfHeader.getAttribute('content');
                form.appendChild(input);
            }
            
            document.body.appendChild(form);
            form.submit();
        }
        
        // ========== FUNCIONES DE TRANSPORTE ==========
        
        // Mostrar formulario para proponer costo de transporte
        function mostrarFormularioTransporte(alquilerId) {
            Swal.fire({
                title: '<i class="bi bi-truck"></i> Proponer Costo de Transporte',
                html: `
                    <p style="margin-bottom: 20px; color: #7f8c8d;">
                        Ingresa el costo de transporte que consideras justo para tu alquiler.
                    </p>
                    <input type="number" 
                           id="costoTransporte" 
                           class="swal2-input" 
                           placeholder="Ej: 50000" 
                           min="0" 
                           step="1000"
                           style="width: 80%; font-size: 18px;">
                `,
                showCancelButton: true,
                confirmButtonText: '<i class="bi bi-send"></i> Enviar Propuesta',
                cancelButtonText: '<i class="bi bi-x"></i> Cancelar',
                confirmButtonColor: '#8cbc00',
                cancelButtonColor: '#6c757d',
                preConfirm: () => {
                    const costo = document.getElementById('costoTransporte').value;
                    if (!costo || costo <= 0) {
                        Swal.showValidationMessage('Por favor ingresa un costo válido');
                        return false;
                    }
                    return costo;
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    proponerTransporte(alquilerId, result.value);
                }
            });
        }
        
        // Enviar propuesta de transporte al servidor
        function proponerTransporte(alquilerId, costoTransporte) {
            Swal.fire({
                title: 'Enviando propuesta...',
                text: 'Por favor espera',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            
            fetch('/alquiler/proponer-transporte', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `alquilerId=${alquilerId}&costoTransporte=${costoTransporte}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        icon: 'success',
                        title: '¡Propuesta Enviada!',
                        html: `
                            <p>Tu propuesta de <strong>$${parseFloat(costoTransporte).toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</strong> ha sido enviada al administrador.</p>
                            <p style="color: #7f8c8d; font-size: 14px; margin-top: 10px;">
                                Recibirás una notificación cuando el administrador responda.
                            </p>
                        `,
                        confirmButtonColor: '#8cbc00',
                        confirmButtonText: 'Entendido'
                    }).then(() => {
                        location.reload();
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: data.message || 'No se pudo enviar la propuesta',
                        confirmButtonColor: '#e74c3c'
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error de Conexión',
                    text: 'No se pudo conectar con el servidor',
                    confirmButtonColor: '#e74c3c'
                });
            });
        }
        
        // Aceptar contrapropuesta del admin
        function aceptarTransporteAdmin(alquilerId) {
            Swal.fire({
                title: '¿Aceptar Contrapropuesta?',
                text: 'El costo de transporte se agregará al total de tu alquiler',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: '<i class="bi bi-check-circle"></i> Sí, Aceptar',
                cancelButtonText: '<i class="bi bi-x"></i> Cancelar',
                confirmButtonColor: '#27ae60',
                cancelButtonColor: '#6c757d'
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        title: 'Procesando...',
                        text: 'Por favor espera',
                        allowOutsideClick: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });
                    
                    fetch('/alquiler/aceptar-transporte-admin', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: `alquilerId=${alquilerId}`
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            Swal.fire({
                                icon: 'success',
                                title: '¡Transporte Acordado!',
                                html: `
                                    <p>Has aceptado el costo de transporte.</p>
                                    <p><strong>Costo acordado:</strong> $${parseFloat(data.costoTransporteAceptado).toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>
                                    <p><strong>Nuevo total:</strong> $${parseFloat(data.totalNuevo).toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>
                                `,
                                confirmButtonColor: '#27ae60',
                                confirmButtonText: 'Perfecto'
                            }).then(() => {
                                location.reload();
                            });
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: data.message || 'No se pudo aceptar la propuesta',
                                confirmButtonColor: '#e74c3c'
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error de Conexión',
                            text: 'No se pudo conectar con el servidor',
                            confirmButtonColor: '#e74c3c'
                        });
                    });
                }
            });
        }
        
        // Rechazar contrapropuesta del admin
        function rechazarTransporteAdmin(alquilerId) {
            Swal.fire({
                title: '¿Rechazar Contrapropuesta?',
                text: 'Podrás hacer una nueva propuesta después',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '<i class="bi bi-x-circle"></i> Sí, Rechazar',
                cancelButtonText: '<i class="bi bi-arrow-left"></i> Volver',
                confirmButtonColor: '#e74c3c',
                cancelButtonColor: '#6c757d'
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        title: 'Procesando...',
                        text: 'Por favor espera',
                        allowOutsideClick: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });
                    
                    fetch('/alquiler/rechazar-transporte-admin', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: `alquilerId=${alquilerId}`
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            Swal.fire({
                                icon: 'info',
                                title: 'Propuesta Rechazada',
                                text: 'Puedes hacer una nueva propuesta cuando quieras',
                                confirmButtonColor: '#8cbc00',
                                confirmButtonText: 'Entendido'
                            }).then(() => {
                                location.reload();
                            });
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: data.message || 'No se pudo rechazar la propuesta',
                                confirmButtonColor: '#e74c3c'
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error de Conexión',
                            text: 'No se pudo conectar con el servidor',
                            confirmButtonColor: '#e74c3c'
                        });
                    });
                }
            });
        }
        
        // Función para abrir modal de reseña desde el botón
        function abrirModalResenaDesdeAlquiler(index) {
            const alquiler = alquileresData[index];
            if (!alquiler) return;
            
            const alquilerId = alquiler.id;
            const productos = alquiler.items.map(item => ({
                id: item.productoId,
                nombre: item.nombreProducto,
                imagen: item.imagenProducto
            }));
            
            // Verificar si ya dejó reseña
            resenaManager.puedeDejarResena(alquilerId).then(puede => {
                if (puede) {
                    resenaManager.abrirModalResenaMultiple(alquilerId, productos);
                } else {
                    Swal.fire({
                        icon: 'info',
                        title: 'Reseña ya enviada',
                        text: 'Ya has dejado una reseña para este alquiler',
                        confirmButtonColor: '#8cbc00'
                    });
                }
            });
        }
    </script>

    <!-- Vista Previa del Carrito -->
    <div th:replace="~{fragments/cart-preview :: cart-preview}"></div>
    
    <!-- Botón Admin -->
    <div th:replace="~{fragments/admin-button :: admin-button}"></div>

</body>
</html>

